{% extends "blog/base.html" %}
{% block content %}
    <h2>Search Results for "{{ query }}"</h2>
    {% if profiles %}
        {% for profile in profiles %}
            <li class="list-group-item">
                <div class="d-flex align-items-center">
                    <img src="{{ profile.user.profile.image.url }}" class="rounded-circle account-img"
                         alt="{{ profile.user.username }}" style="">
                    <a class="account-heading" href="{% url 'profile' profile.user.id %}">{{ profile.user.username }}</a>
                </div>
            </li>
        {% endfor %}
    {% endif %}
    {% if posts %}
        {% for post in posts %}
            <article class="media content-section">
                <div class="row">
                    <div class="col-md-2">
                        <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}">
                    </div>
                    <div class="col-md-10">
                        <div class="media-body">
                            <div class="article-metadata">
                                <a class="mr-2" href="{% url 'profile' post.author.profile.id %}">{{ post.author }}</a>
                                <small class="text-muted">{{ post.created_at|date:"F d, Y" }}</small>
                            </div>
                            <img class="article-img h-100 w-100" src="{{ post.image.url }}">
                            <a class="article-content" href="{% url 'post-detail' post.id %}">{{ post.content }}</a>
                            <br>

                            {% if user.is_authenticated %}
                                <form method="post" style="display: inline;">
                                    {% csrf_token %}
                                    <input type="hidden" name="post_id" value="{{ post.pk }}">
                                    {% if user in post.likes.all %}
                                        <button class="btn btn-link" style="padding: 0; border: none;" name="action"
                                                value="unlike" type="submit">
                                            <i class="fas fa-heart" style="color: red; font-size: 24px;"></i>
                                        </button>
                                    {% else %}
                                        <button class="btn btn-link" style="padding: 0; border: none;" name="action"
                                                value="like" type="submit">
                                            <i class="far fa-heart" style="color: gray; font-size: 24px;"></i>
                                        </button>
                                    {% endif %}
                                </form>
                            {% endif %}

                            {% if post.likes.all.count == 1 %}
                                <span style="color:grey;"> {{ post.likes.all.count }} like</span>
                            {% else %}
                                <span style="color:grey;"> {{ post.likes.all.count }} likes</span>
                            {% endif %}
                            <br>
                            <br>
                        </div>
                    </div>
                </div>
            </article>

        {% endfor %}
        {% if is_paginated %}
            {% if page_obj.has_previous %}
                <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
            {% endif %}
            {% for num in page_obj.paginator.page_range %}
                {% if page_obj.number == num %}
                    <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
                {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                    <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
                <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
            {% endif %}
        {% endif %}
    {% else %}
        <p>No posts found with the tag "{{ query }}".</p>
    {% endif %}
{% endblock content %}
